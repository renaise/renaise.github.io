---
import Base from '../../layouts/Base.astro';
import { labProjects, labOnlyProjects } from '../../data/projects-expanded';

export function getStaticPaths() {
  return labProjects.map((project) => ({
    params: { id: project.id },
    props: { project },
  }));
}

const { project } = Astro.props;
const p = project;
const isConcept = labOnlyProjects.some(lp => lp.id === p.id);

const sections = [
  { label: 'Context', content: p.lab.context },
  { label: 'Challenge', content: p.lab.challenge },
  { label: 'Hypothesis', content: p.lab.hypothesis },
  { label: 'Approach', content: p.lab.approach.join(' → ') },
  { label: 'Key Decisions', content: p.lab.keyDecisions.map(kd => kd.decision).join('. ') },
  { label: 'Insight', content: p.lab.insight },
  { label: 'Implications', content: p.lab.implications },
  { label: 'View Shipped Work', content: '', isLink: true, href: `/stage#${p.id}` },
  { label: 'Back to Lab', content: '', isLink: true, href: '/lab' },
];

const displaySections = isConcept
  ? sections.filter(s => s.label !== 'View Shipped Work')
  : sections;
---

<Base title={`${p.lab.title} — Lab of Renaise`}>
  <div class="h-screen w-screen overflow-hidden flex flex-col" style="background: linear-gradient(180deg, #E3E3E3 0%, #9B9B9B 100%);">

    <!-- Dot grid background -->
    <div class="dot-grid fixed inset-0 z-0 pointer-events-none" aria-hidden="true">
      <svg width="100%" height="100%">
        <pattern id="dots-lab-detail" x="0" y="0" width="32" height="32" patternUnits="userSpaceOnUse">
          <circle cx="16" cy="16" r="1" fill="currentColor" />
        </pattern>
        <rect width="100%" height="100%" fill="url(#dots-lab-detail)" />
      </svg>
    </div>

    <!-- Top Navigation -->
    <header class="relative z-10 flex items-center justify-between px-6 py-4 shrink-0">
      <a href="/lab" class="nav-pill">
        <span>← Lab</span>
      </a>
      <nav class="flex items-center gap-2">
        <a href="/" class="nav-pill">Stage</a>
        <a href="mailto:hello@renaise.com" class="nav-pill">Contact</a>
      </nav>
    </header>

    <!-- Grid -->
    <div class="relative z-10 flex-1 grid grid-cols-3 grid-rows-3 border-t border-black/10">
      {displaySections.slice(0, 9).map((section, i) => (
        section.isLink ? (
          <a
            href={section.href}
            class="lab-cell relative border-r border-b border-black/10 flex flex-col p-5 hover:bg-white/20 transition-colors"
          >
            <div class="flex items-start justify-between mb-auto">
              <span class="w-6 h-6 flex items-center justify-center text-[11px] text-black/50 border border-black/20 rounded">
                {i + 1}
              </span>
            </div>
            <div class="flex flex-col items-center justify-center my-auto">
              <svg class="w-6 h-6 text-black/30 mb-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
              <span class="text-[14px] md:text-[16px] text-black/60 uppercase tracking-widest">{section.label}</span>
            </div>
            <div class="mt-auto"></div>
          </a>
        ) : (
          <div class="lab-cell relative border-r border-b border-black/10 flex flex-col p-5">
            <div class="flex items-start justify-between mb-auto">
              <span class="w-6 h-6 flex items-center justify-center text-[11px] text-black/50 border border-black/20 rounded">
                {i + 1}
              </span>
              <span class="text-[10px] uppercase tracking-widest text-black/40">{section.label}</span>
            </div>
            <p class="text-[13px] md:text-[15px] lg:text-[16px] text-black/70 leading-relaxed text-center my-auto px-2 line-clamp-[6]">
              {section.content}
            </p>
            <div class="mt-auto"></div>
          </div>
        )
      ))}
    </div>

  </div>
</Base>

<style>
  .dot-grid {
    color: rgba(0, 0, 0, 0.08);
  }

  /* Nav pills */
  .nav-pill {
    padding: 10px 20px;
    font-size: 12px;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    color: rgba(0, 0, 0, 0.6);
    background: rgba(255, 255, 255, 0.5);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(0, 0, 0, 0.06);
    border-radius: 100px;
    transition: all 0.2s ease;
  }

  .nav-pill:hover {
    background: rgba(255, 255, 255, 0.8);
    color: rgba(0, 0, 0, 0.8);
  }

  /* Remove right border on last column */
  .lab-cell:nth-child(3n) {
    border-right: none;
  }

  /* Remove bottom border on last row */
  .lab-cell:nth-child(n+7) {
    border-bottom: none;
  }
</style>
